import{l as I,_ as z,u as Y,q as H,g as C,s as W,h as Q,o as c,c as u,a as o,z as Z,e as M,t as h,k as m,m as p,v as _,y as D,p as G,f as J}from"./index-feffca74.js";import{u as K}from"./useData-a1bdd8e8.js";function L(){const d=I({phone:"",address:"",paymentMethod:""}),r=I({number:"",name:"",expiryDate:"",cvv:""}),t=I({phoneErr:[],addressErr:[],payErr:[],numErr:[],nameErr:[],exDateErr:[],cvvErr:[]}),e=()=>{t.phoneErr=[],t.addressErr=[],t.payErr=[],t.numErr=[],t.nameErr=[],t.exDateErr=[],t.cvvErr=[]};return{checkEmptyErr:()=>{for(const O in t)if(t[O].length!==0)return!1;return!0},checkForm:()=>{e(),d.phone?(d.phone.startsWith("84")||t.phoneErr.push("Phone numbers must start with 84"),d.phone.length!=11&&t.phoneErr.push("Phone numbers must have exactly 11 digits"),/[0-9]{11}/.test(d.phone)||t.phoneErr.push("Phone numbers can only contain numbers")):t.phoneErr.push("Entering phone number is required"),d.address||t.addressErr.push("Entering address is required"),d.paymentMethod?d.paymentMethod=="card"?(r.number?(r.number.startsWith("4")||t.numErr.push("Visa card numbers must start with 4"),r.number.length!=16&&t.numErr.push("Visa card numbers must have exactly 16 digits"),/[0-9]{16}/.test(r.number)||t.numErr.push("Visa card numbers can only contain numbers")):t.numErr.push("Entering card number is required"),r.name?/^[A-Za-z]+$/.test(r.name.replace(/\s/g,""))||t.nameErr.push("A name can only contain letters"):t.nameErr.push("Entering name is required"),r.expiryDate||t.exDateErr.push("Entering expiry date is required"),r.cvv?(r.cvv.length!=3&&t.cvvErr.push("Cvv code must have exactly 3 digits"),/[0-9]{3}/.test(r.cvv)||t.cvvErr.push("Cvv code can only contain numbers")):t.cvvErr.push("Entering cvv code is required")):d.paymentMethod=="cash"&&(r.number="",r.name="",r.expiryDate="",r.cvv="",t.numErr=[],t.nameErr=[],t.exDateErr=[],t.cvvErr=[]):t.payErr.push("Selecting payment method is required")},isPaid:()=>{if(d.paymentMethod==="cash")return"false";if(d.paymentMethod==="card")return"true"},checkoutObj:d,cardObj:r,errObj:t}}const X={setup(){const r=Y().user,t=H(),{getAllFoods:e,foods:k}=K(),{checkEmptyErr:b,checkForm:s,isPaid:O,checkoutObj:E,cardObj:V,errObj:w}=L();e();const f=C([]),v=C([]),S=W(async()=>{try{r&&(await axios.get("/cartItem/"+r.user_id)).data.forEach(n=>{f.value.push(n.product_id),v.value.push(n.item_qty)})}catch(a){console.log(a)}}),g=Q(()=>k.value.filter(a=>F(a,f.value)));let F=(a,n)=>{let i="";return n.forEach(l=>{parseInt(a.product_id)===l&&(i=a)}),i};const x=()=>{let a=0,n=0,i=15,l=0;for(;l<v.value.length;)a+=parseInt(g.value[l].product_price)*v.value[l],n=n+parseInt(g.value[l].product_discount)*v.value[l],l=l+1;g.value.length||(i=0);let j=a-n+i;return[a,n,i,j]},P=()=>{let a=new Date,n=("0"+(a.getMonth()+1)).slice(-2),i=a.getFullYear()+"-"+n,l=a.getFullYear()+10+"-"+n;document.getElementById("coCardEx").setAttribute("min",i),document.getElementById("coCardEx").setAttribute("max",l)},A=async(a,n,i)=>{let l={order_id:parseInt(a),product_id:parseInt(n),item_qty:parseInt(i)};await axios.post("/orderdetails",l)};return{getAllCartItem:S,filterFoods:g,user:r,calculateSummaryPrice:x,availableTime:P,checkEmptyErr:b,checkForm:s,checkoutObj:E,cardObj:V,errObj:w,handleSubmit:async a=>{if(s(),!b())a.preventDefault();else{a.preventDefault();let n=(await axios.get("/orderStatus/new")).data;n==""?n=1:n=parseInt(n.order_id)+1,f.value.forEach((B,R)=>{A(n,B,v.value[R])});let i=new Date,l=("0"+i.getDate()).slice(-2),j=("0"+(i.getMonth()+1)).slice(-2),q=("0"+i.getHours()).slice(-2),N=("0"+i.getMinutes()).slice(-2),U=i.getFullYear()+"-"+j+"-"+l+"T"+q+":"+N,T={order_id:parseInt(n),user_id:parseInt(r.user_id),order_phone:E.phone,order_address:E.address,order_when:U,order_method:E.paymentMethod,order_discount:parseInt(x()[1]),order_delivery:parseInt(x()[2]),order_total:parseInt(x()[3]),order_paid:O(),order_status:1};axios.post("/orderstatus",T),axios.delete("/cartItem/"+r.user_id),f.value=[],v.value=[],t.push("/thanks")}}}}},y=d=>(G("data-v-6d4b69b8"),d=d(),J(),d),$={class:"checkout-container"},ee={class:"checkout-form-container"},re={class:"checkout-heading"},te=y(()=>o("h3",null,[M("Few more step to place your order"),o("span",null,"Total")],-1)),oe={key:0},se={class:"form-group details-group"},ne=y(()=>o("h4",null,"Shipping Details",-1)),ae={class:"form-group"},de={key:0,class:"error-mess"},ie={class:"form-group"},le={key:0,class:"error-mess"},ce={class:"form-group details-group"},ue=y(()=>o("h4",null,"Payment Method",-1)),me={class:"form-group"},he={class:"form-group"},pe=y(()=>o("span",null,"Cash",-1)),ve=y(()=>o("span",null,"Card (Visa)",-1)),_e={key:0,class:"error-mess"},ye={key:0},be={class:"form-group"},Ee={key:0,class:"error-mess"},fe={class:"form-group"},ge={key:0,class:"error-mess"},xe={class:"form-group"},ke={class:"form-control"},Oe=y(()=>o("span",{style:{"font-size":"1.6rem",position:"absolute","margin-left":"-5px","margin-top":"-11px"}},"Expiry Date: ",-1)),je={key:0,class:"error-mess"},Ie={class:"form-group"},Ce={key:0,class:"error-mess"},De={key:0,class:"form-group"},Me=["disabled"];function Ve(d,r,t,e,k,b){return c(),u("div",$,[o("div",ee,[o("form",{id:"checkoutForm",onSubmit:r[9]||(r[9]=Z((...s)=>e.handleSubmit&&e.handleSubmit(...s),["prevent"])),novalidate:"",autocomplete:"off"},[o("div",re,[te,e.user?(c(),u("h3",oe,[M(h(e.user.user_name)+"'s Order",1),o("span",null,"$"+h(e.calculateSummaryPrice()[3]),1)])):m("",!0)]),o("div",se,[ne,o("div",ae,[p(o("input",{type:"text",name:"coPhone",id:"coPhone",placeholder:"Phone number",class:"form-control","onUpdate:modelValue":r[0]||(r[0]=s=>e.checkoutObj.phone=s)},null,512),[[_,e.checkoutObj.phone]]),e.errObj.phoneErr.length>0?(c(),u("p",de,h(e.errObj.phoneErr[0]),1)):m("",!0)]),o("div",ie,[p(o("input",{type:"text",name:"coAddress",id:"coAddress",placeholder:"Address in Hanoi, Vietnam",class:"form-control","onUpdate:modelValue":r[1]||(r[1]=s=>e.checkoutObj.address=s)},null,512),[[_,e.checkoutObj.address]]),e.errObj.addressErr.length>0?(c(),u("p",le,h(e.errObj.addressErr[0]),1)):m("",!0)])]),o("div",ce,[ue,o("div",me,[o("div",he,[p(o("input",{type:"radio",name:"payment",value:"cash",id:"paymentCash","onUpdate:modelValue":r[2]||(r[2]=s=>e.checkoutObj.paymentMethod=s)},null,512),[[D,e.checkoutObj.paymentMethod]]),pe,p(o("input",{type:"radio",name:"payment",value:"card",id:"paymentCard","onUpdate:modelValue":r[3]||(r[3]=s=>e.checkoutObj.paymentMethod=s)},null,512),[[D,e.checkoutObj.paymentMethod]]),ve]),e.errObj.payErr.length>0?(c(),u("p",_e,h(e.errObj.payErr[0]),1)):m("",!0)]),e.checkoutObj.paymentMethod==="card"?(c(),u("div",ye,[o("div",be,[p(o("input",{type:"text",name:"coCardNum",placeholder:"Enter your card number",id:"coCardNum",class:"form-control","onUpdate:modelValue":r[4]||(r[4]=s=>e.cardObj.number=s),size:"16",maxlength:"16"},null,512),[[_,e.cardObj.number]]),e.errObj.numErr.length>0?(c(),u("p",Ee,h(e.errObj.numErr[0]),1)):m("",!0)]),o("div",fe,[p(o("input",{type:"text",name:"coCardName",placeholder:"Enter the name in your card ",id:"coCardName",class:"form-control","onUpdate:modelValue":r[5]||(r[5]=s=>e.cardObj.name=s)},null,512),[[_,e.cardObj.name]]),e.errObj.nameErr.length>0?(c(),u("p",ge,h(e.errObj.nameErr[0]),1)):m("",!0)]),o("div",xe,[o("div",ke,[Oe,p(o("input",{style:{position:"absolute","margin-left":"100px","margin-top":"-12px",background:"inherit"},type:"month",name:"coCardEx",id:"coCardEx","onUpdate:modelValue":r[6]||(r[6]=s=>e.cardObj.expiryDate=s),onClick:r[7]||(r[7]=s=>e.availableTime())},null,512),[[_,e.cardObj.expiryDate]])]),e.errObj.exDateErr.length>0?(c(),u("p",je,h(e.errObj.exDateErr[0]),1)):m("",!0)]),o("div",Ie,[p(o("input",{type:"text",name:"coCardCvv",placeholder:"CVV",id:"coCardCvv",class:"form-control","onUpdate:modelValue":r[8]||(r[8]=s=>e.cardObj.cvv=s)},null,512),[[_,e.cardObj.cvv]]),e.errObj.cvvErr.length>0?(c(),u("p",Ce,h(e.errObj.cvvErr[0]),1)):m("",!0)])])):m("",!0)]),e.user?(c(),u("div",De,[o("input",{type:"submit",value:"CONFIRM & PAY",class:"btn",disabled:!e.filterFoods.length},null,8,Me)])):m("",!0)],32)])])}const Pe=z(X,[["render",Ve],["__scopeId","data-v-6d4b69b8"]]);export{Pe as default};
